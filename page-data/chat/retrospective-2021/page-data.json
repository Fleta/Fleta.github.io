{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/chat/retrospective-2021/",
    "result": {"data":{"cur":{"id":"0a8fc458-95ea-5a92-9031-37a979836ffa","html":"<h1 id=\"알고리즘-스터디-계획\" style=\"position:relative;\"><a href=\"#%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98-%EC%8A%A4%ED%84%B0%EB%94%94-%EA%B3%84%ED%9A%8D\" aria-label=\"알고리즘 스터디 계획 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>알고리즘 스터디 계획</h1>\n<h2 id=\"1-2021년에-뭐했나\" style=\"position:relative;\"><a href=\"#1-2021%EB%85%84%EC%97%90-%EB%AD%90%ED%96%88%EB%82%98\" aria-label=\"1 2021년에 뭐했나 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 2021년에 뭐했나</h2>\n<h3 id=\"1월\" style=\"position:relative;\"><a href=\"#1%EC%9B%94\" aria-label=\"1월 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1월</h3>\n<p>입사 3개월차. 평소에 좀 많이 이상한 분이라고 생각했던 옆 자리 사람이 정직을 당했다.\r\n정말 이상한 코드들이 널리고 널렸는데 개선을 못 하게 하는 주범이 사라지게 되어서 앞으로 어떻게 할 지 얘기를 좀 했었던 것 같다.\r\n일단은 남아있는 생쿼리들을 ORM으로 옮기자고 얘기해서 feature들을 올리면서 중간중간 리팩토링을 개선했던 것 같은데 그 뒤로 기억이 잘 안 난다.\r\n2월달에 엄청난 사건이 터졌던게 원인인 것 같다.</p>\n<h3 id=\"2월\" style=\"position:relative;\"><a href=\"#2%EC%9B%94\" aria-label=\"2월 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2월</h3>\n<p>하룻밤만에 시스템이 싹 다 사라지는 엄청난 장애가 터졌다. 자고 일어나보니 몇몇 분들은 한밤중에 연락 받아서 진작에 회사 나가서 인프라를 다시 구축하는 중이었다. 하루 정도를 들여 웹 스토어는 다시 오픈했으나 기존 주문건을 수기로 처리하느라 신규 주문의 처리가 지연되었으며, 이 때문에 평소 대비 5배 정도까지 주문이 쌓이게 되었다. 문제는 기존 시스템이 n+1문제가 심각해서 주문건이 5배 수준이 되었다고 페이지들이 로딩이 안 되어서 시스템으로 주문을 처리할 수 없는 지경까지 이르렀던 것이다. 그래서 단기간에 사용 가능하도록 바꾸고자 3주동안 매일 12시간씩 일했던 것 같다. (10시에 출근해서 10시에 퇴근하는 ..)\r\n제일 심했던 케이스는 아직도 기억하는데, 하나의 endpoint를 서로 다른 6개 정도의 서브도메인에 해당하는 14개의 메뉴에서 사용하고 있는 케이스였다. 그 함수를 살펴보니 혼돈 그 자체였다. 서로 다른 서브도메인을 위한 비즈니스 로직이 같은 컨트롤러에 엮여 있었고 하나의 메소드에서 모든 경우의 수를 다 생각해야 했기에 join이 10개씩 걸린 쿼리가 실행되는 코드들이 무수한 if들과 함께 널려있었다. 거의 java 코드의 역사책을 보는 수준이었는데, 어떤 함수는 jdbcTemplate로 실행되는 쿼리 결과를 바탕으로 돌아가고 어떤 함수는 (custom)criteria builder로 쿼리가 돌아가고 어떤 함수는 JPA로 돌아가고 있었다. JPQL도 native query인 것과 아닌 것들이 섞여 있을 정도로 난리도 아니였다. 사실 방금 나온 얘기들만 해도 repository를 통해 외부의 데이터를 가져오는 코드가 최소 5줄은 된다는 소리일텐데, 하나의 함수에서 데이터를 5번씩이나 가져와야 할 일이 얼마나 있을까?\r\n방금 얘기했던 케이스는 정말 심했던 편이지만 여튼 전체적으로 문제가 많아서 빠르게 고칠 수 있는 부분은 빠르게 고쳐서 서비스를 운영 가능한 수준까지 올리는데 거의 1주 정도를 밤낮없이 일했던 것 같다. 그래서 날아간 서비스를 복구하고 기존 서비스를 개선하느라 순식간에 지나간 한 달이었던 것으로 기억한다.</p>\n<h3 id=\"3월\" style=\"position:relative;\"><a href=\"#3%EC%9B%94\" aria-label=\"3월 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3월</h3>\n<p>솔직히 잘 기억 안나서 커밋로그들을 봤는데 기존 서비스의 편의성과 관련된 기능 업데이트에 집중했던 것 같다. 기록 상으로는 셀러들 시스템이랑 연동한다던가, 운영 정책 변경에 대응하기 위한 수정을 하는 등의 업무에 집중했던 것 같다. 커밋 로그들이 주로 생산성 개선, 정책 변경 대응같이 남아있는 것 봐서는 그랬던 것 같은데 잘 기억은 안 난다.</p>\n<h3 id=\"4월\" style=\"position:relative;\"><a href=\"#4%EC%9B%94\" aria-label=\"4월 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4월</h3>\n<h3 id=\"5월\" style=\"position:relative;\"><a href=\"#5%EC%9B%94\" aria-label=\"5월 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5월</h3>\n<h3 id=\"6월\" style=\"position:relative;\"><a href=\"#6%EC%9B%94\" aria-label=\"6월 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6월</h3>\n<h3 id=\"7월\" style=\"position:relative;\"><a href=\"#7%EC%9B%94\" aria-label=\"7월 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7월</h3>\n<h3 id=\"8월\" style=\"position:relative;\"><a href=\"#8%EC%9B%94\" aria-label=\"8월 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8월</h3>\n<h3 id=\"9월\" style=\"position:relative;\"><a href=\"#9%EC%9B%94\" aria-label=\"9월 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9월</h3>\n<h3 id=\"10월\" style=\"position:relative;\"><a href=\"#10%EC%9B%94\" aria-label=\"10월 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10월</h3>\n<h3 id=\"11월\" style=\"position:relative;\"><a href=\"#11%EC%9B%94\" aria-label=\"11월 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>11월</h3>\n<h3 id=\"12월\" style=\"position:relative;\"><a href=\"#12%EC%9B%94\" aria-label=\"12월 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>12월</h3>","excerpt":"알고리즘 스터디 계획 1. 2021년에 뭐했나 1월 입사 3개월차. 평소에 좀 많이 이상한 분이라고 생각했던 옆 자리 사람이 정직을 당했다.\r\n정말 이상한 코드들이 널리고 널렸는데 개선을 못 하게 하는 주범이 사라지게 되어서 앞으로 어떻게 할 지 얘기를 좀 했었던 것 같다.\r\n일단은 남아있는 생쿼리들을 ORM으로 옮기자고 얘기해서 feature들을 올리면서 중간중간 리팩토링을 개선했던 것 같은데 그 뒤로 기억이 잘 안 난다.\r\n2월달에 엄청난 사건이 터졌던게 원인인 것 같다. 2월 하룻밤만에 시스템이 싹 다 사라지는 엄청난 장애가 터졌다. 자고 일어나보니 몇몇 분들은 한밤중에 연락 받아서 진작에 회사 나가서 인프라를 다시 구축하는 중이었다. 하루 정도를 들여 웹 스토어는 다시 오픈했으나 기존 주문건을 수기로 처리하느라 신규 주문의 처리가 지연되었으며, 이 때문에 평소 대비 5배 정도까지 주문이 쌓이게 되었다. 문제는 기존 시스템이 n+1문제가 심각해서 주문건이 5배 수준이 되었다고…","frontmatter":{"date":"December 31, 2021","title":"2021년 회고","categories":"Chat","author":"fleta","emoji":"🔮"},"fields":{"slug":"/chat/retrospective-2021/"}},"next":{"id":"a40a6967-afef-5257-abb1-db3378c8e872","html":"<h1 id=\"서론\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%A1%A0\" aria-label=\"서론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서론</h1>\n<p>폭발적으로 성장하는 서비스들은 그 성장세를 효과적으로 처리하기 위한 고민을 한다. 감사하게도 내가 있는 회사의 서비스도 굉장히 폭발적으로 성장하였다. 2020년 11월에 입사해서 어느덧 1년이 다 되어가는데, 그 사이에 매출이 거의 2.5배 정도로 뛰었다. 작년 11월에 입사했을 때도 거의 매일같이 순 거래액을 갱신할 정도로 크게 성장했는데, 그 이후에도 멈추지 않고 현재까지 달려왔다. ‘이 목표액 달성하면 전 직원 하와이 보내드리겠습니다’ 하고 CEO가 얘기한 조금은 허황되어 보였던 금액도 지금이라면 진짜 달성할 것 같다고 생각할 정도로 많이 성장했다. 우리 메인 페이지의 트래픽도 많이 늘었듯이 내가 담당하는 백오피스 시스템의 시스템 메트릭들도 껑충껑충 뛰고 있다. 물론 메트릭이 뛰는 이유는 대체로 과거에 이 시스템이 개같이 만들어졌고 그것을 적절한 시기에 청산하지 못한 잘못이 제일 크지만, 이 서비스를 갈아엎고 새 서비스를 만드는게 기존 서비스를 수정하는 것과 비슷한 공수가 들 것이라 생각하면서 자연스럽게 대규모 시스템들은 어떻게 설계가 되는지 관심을 갖게 되었다. 그래서 최근에 몇 가지 도서와 여타의 자료들을 찾아보게 되었고, 그 과정에서의 나의 부족한 생각들을 기록으로 남기고자 글을 적는다.</p>\n<p>기본적이고 추상적인 개념들부터 그 개념들에 대한 나름 상세한 고찰(?)을 반복하는 식으로 글을 적게 될 것 같다. 오늘처럼 며칠 어치 작게 공부한 내용들을 모으면 이렇게 하나의 글을 적을 수 있게 된다. 그런 식으로 설계에 대해서만 한 달 정도에 거쳐 5개 내외의 글을 적게 될 것 같다. 오늘 적을 글은 시스템 설계시 고려되는 점들에 대해 적어볼 생각이다. 사진에 들어있는 그림들 중에서는 다른 아이콘들에 비해 귀여운 그림이 있는데 이 그림들은 전부 <a href=\"http://www.irasutoya.com/\">이라스토야(irasutoya)</a>에서 배포하는 그림들이다.</p>\n<h1 id=\"설계와-확장성\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EA%B3%84%EC%99%80-%ED%99%95%EC%9E%A5%EC%84%B1\" aria-label=\"설계와 확장성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설계와 확장성</h1>\n<p>사실 확장성에 대해 얘기하려면 <em>어디에서부터</em> 확장되는지 먼저 얘기해야 한다. 그래서 가장 단순한 구조는 어떻냐는 얘기를 한다면, 물론 어떤 서비스를 만드느냐에 따라 설계에 대한 얘기는 모두 다르지만, 어떤 서비스든지 사용자에게 어떤 기능을 ‘보여줘야’ 한다는 공통점이 있다. 그래서 필수적으로 웹(api) 서버와 그것을 보여주는 어떤 존재들(e.g. 웹페이지, 모바일 어플리케이션 등)이 필요하다. 이렇게 필수적인 존재들만 있다고 했을 때의 구조는 아래와 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC8ElEQVQ4y3WUS28aZxSG/bMiVYrUX1BVXXTbRbvoqqq6aJRVumnsVK1raqW2k7jCqh03Na0dnFiUYCiOS7gN2CDMzRiGmsDAwMDcuNh5qhmLyHXM4h3NnJnv+c55z5lvSlENqg2ZWDpHvaVwkCnQUjTaPR25a0mjo5k0eyZdY4AxPKer9+249c1VTeln4H++iWvuFq61NZZufUqv00LumbQUFbU/IpE44I9H8xyXykSEA07EUxTNtKFXwVOqOSQiHBLd9RAOBUh4V2i2ZNqqgayoKMaIYkbgxPsdP3x/jxs33uPhspPBOTQ7vXeBw9GAb1wvufNwl4CwyvTaMqJYp6Ma9gLVOCMQ9+LzObg/P8vNm++zseHCHL25HqiaA7aDIT7+2kE0ESTo/gW53bX9svy1/MqkYuz+9RzPs03uzztICBG6+oSSrUunp1P6t0G2WOH0dYOaJFMoVSiWRcRag9NGi/1wjJ4xQB+c2dlPbMp4F60/pFpr4PX/Tb5UJhxLEIrGOczk2N7xcFKt2Y24XObEDK2g7Zc5JF+q4Np0U291kNpd/ny6zVH+GK0/srt+FXZZ/wNe1uMnG2+B67+7bNAYZmn83LLuL8l69w7Q8ue1JCMkD0llspQqVTs29s4q28pWH56j6gamrmMaF1LGGY6h1q5a/4xQOMq9mRmWFpdYfrRM6ihHMp3BF9izlUwfsfXUzWG5wU9xhdvBJg8SbWpt7TrgiGg8gWPOgdPpZMW5QvFEtBuVP75Q9riM3/eCJ8kaH2xJfLhV56OtOmGxNxn44+ysnd3643X8wX2C+yEblskVSWULiJUKnqLCF74mX/okvvI3iVYnACMxgZnpaRZ+XmD111W8uwGC+6/sMdr75xWpowLFQh53ts0nOxKfv5D5zCMRmQQMR+Pc/fYuiwuL7Ox47EYYozd2UzqqaR8Yen+IKGv8lpaZ26vgznVoKFc8HM9SQ+4QFZIIB+m3p8p1Y9NVdXRNQ5IkDP3ij/sPdYl5+n3HqL4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"basic-architecture\"\n        title=\"basic-architecture\"\n        src=\"/static/0df748a1ff871d5c98dd83d8189e97de/37523/basic_architecture.png\"\n        srcset=\"/static/0df748a1ff871d5c98dd83d8189e97de/e9ff0/basic_architecture.png 180w,\n/static/0df748a1ff871d5c98dd83d8189e97de/f21e7/basic_architecture.png 360w,\n/static/0df748a1ff871d5c98dd83d8189e97de/37523/basic_architecture.png 720w,\n/static/0df748a1ff871d5c98dd83d8189e97de/302a4/basic_architecture.png 1080w,\n/static/0df748a1ff871d5c98dd83d8189e97de/07a9c/basic_architecture.png 1440w,\n/static/0df748a1ff871d5c98dd83d8189e97de/668c6/basic_architecture.png 1692w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그림의 구조는 서버 한 대가 서비스의 모든 기능을 제공하는 형태이다. (DNS같은 서비스는 생략) 사용자가 웹/모바일 어플리케이션 등의 어떤 인터페이스를 통해 서버에 요청을 하면 한 대의 서버가 모든 기능을 제공하는 형태이다. 가장 빠르게 만들 수 있고, 요즘 cpu나 클라우드 서비스의 가격을 생각하면 어지간한 트래픽은 저렴한 서버 한 대로도 수행할 수 있다.</p>\n<p>위와 같은 구조로 초기 서비스를 만들고 운영하다 보니 사용자가 점점 많아지면 언젠가 서버 한 대로는 트래픽을 안정적으로 수행하기 힘들 때가 온다. 이유는 여러가지가 될 수 있다. 단순하게 예상 가능한 이유 두 가지는 대략적으로 아래와 같다.</p>\n<ol>\n<li>순수하게 사용자가 늘어서 트래픽이 증가했고 서버의 자원이 부족해서 늘어난 트래픽을 처리하지 못 함</li>\n<li>서비스 규모가 커지면서 배포가 잦아졌는데 장비 외적인 이슈(인력부족 등)로 서비스의 안정성이 떨어지는 경우</li>\n</ol>\n<p>만약 1번 케이스라면, 트래픽을 처리하기 위해 <strong><em>scale up</em></strong> 또는 <strong><em>scale out</em></strong> 을 고민할 것이다. <strong><em>Scale up</em></strong> 은 장비의 성능을 올려서 문제를 해결하는 방식이다. Scale up에는 장비의 성능이라는 분명한 한계가 존재하긴 하지만 아주 작은 서비스에서 시작했다면 보통 비용상의 문제로 scale up을 할 여지는 분명히 남아있을 것이고 그럼 하드웨어 성능을 개선하는 것으로 당면한 문제를 빠르게 해결할 수 있다. 반대로 <strong><em>Scale out</em></strong> 은 하나의 장비에서 하던 일을 여러 장비들이 처리할 수 있도록 확장하는 방식이다. 쉽게는 비슷한 수준의 서버를 몇 개 더 띄우고 그 서버들에 서비스를 그대로 배포해서 parellel하게 돌아가는 서비스들을 load balancer로 묶는 방식이다. 각각의 방식은 분명한 장단점이 존재한다.\r\nScale up은 단순히 서버의 사양만 올리는 것이라서 인스턴스의 성능을 바꾸는 것을 제외하면 할 일이 없다. 네트워크 설정도 그대로고 서비스 배포도 똑같이 하면 되고 소프트웨어를 변경할 필요조차 없다. 소프트웨어의 측면에서는 기존과 완전히 똑같기 때문에 데이터의 정합성 이슈에서 굉장히 자유롭다. 그런데 언제까지나 서버의 성능을 올리는 것으로 문제를 해결할 수는 없다. Scale up은 성능이 올라갈수록 가성비가 떨어진다. 그리고 명확한 한계가 존재한다. 언젠가는 너무 비싼 장비를 사야 하거나, 그마저도 못하기 때문이다. 보통 클라우드 환경에서 운영하는 사람들은 인스턴스를 빠르게 띄우고 내릴 수 있는 환경의 특성 때문에 단일 서버로 돌아가는 서비스를 운영하는 케이스가 잘 없다.</p>\n<p>첫 회사는 이미 IDC에 입주해 있었고 AWS를 너무나 싫어했던 나머지 실물서버를 지속적으로 관리하는 방식으로 운영해 왔었다. 이런 환경이라면 스케일업을 할 때는 또 다른 이슈가 생기는데, 바로 공간과 전력 그리고 냉각의 문제이다. 사실 IDC에 입주했다는 시점에서 전력과 냉각 문제는 없을 것 같은데(IDC에서 냉각 이슈가 있으면 그냥 같은 공간을 쓰는 장비들이 전부 다운되는 것 아닌지…) <strong>공간</strong>이 제일 문제이다. 만약 서버의 디스크로 HDD를 사용한다고 가정해보자. (물론 아직까지도 HDD가 달린 서버를 관리하러 IDC에 들어가는 회사라면 즉시 탈주해야 한다) 용량이 부족해서 scale up을 하러 IDC를 방문해서 랙을 봤는데 랙에 공간이 없거나 보드에 SATA포트가 부족하면 어떻게 할 것인가? SATA포트가 없다면 정말 어거지로 외장하드라도 붙일 수 있는데 공간이 부족하면 답이 없다. HDD를 공간 대비 용량이 높은 SSD로 교체하거나 서버를 늘려야 한다.  다른 부속들도 마찬가지다. 이런 공간적인 한계에 미치면 무조건 장비를 바꾸게 된다. (왜 이렇게 길게 적었나 생각해보니 전 회사가 정말 쓰레기같은 서버를 쓰고 있어서 항상 욕을 했었고 이게 결국 트래픽을 못 버티니 새 장비를 구매했는데 어떻게든 싸게 사려고 중고를 샀었고 그 중고 서버의 성능이 정말 처참해서 이럴거면 AWS라도 쓰라고 했던 기억이 있다.)</p>\n<p>Scale out은 서버의 갯수를 늘리는 것을 지칭하는 말이다. 특히 클라우드 환경에서는 새로운 인스턴스를 띄우고 내리는 것이 매우 빠르기 떄문에 서버의 성능 확장을 수평적으로 하는 것이 서비스의 운영에 굉장히 유리한 것으로 보인다. 또한 정말 고성능의 서버를 하나 운영하는 것 보다 저성능의 서버를 여러대 운영하는 것이 가성비가 더 높을수도 있다. 자체적으로 서버실을 가지고 있거나 IDC에 입주했다면 공간적인 문제 때문에 이런 선택을 하기 어려울 수 있지만 클라우드는 얘기가 다르다. 그리고 성능적인 한계가 없다. 새로운 서버를 올릴 여건만 충분하다면 성능적인 측면은 걱정할 일이 없다. 이러한 구조는 굉장히 유연하고 빠르다. 한번에 단일 서버로 트래픽이 몰리는 경우 필연적으로 병목현상이 생길 수 밖에 없는데, 서버를 유연하게 띄울 수만 있다면(autoscaling) 이러한 걱정을 할 일이 없다. 그렇지만 강한 힘에는 강한 책임이 따르는데, 서비스를 수평적으로 운영하기 위해서는 신경써야 할 이슈들이 많다. 여러대의 서버에서 작업을 나누기 때문에 데이터의 정합성 이슈가 있다. 만약 서버에 저장되는 데이터가 있다면 그 데이터를 어떤식으로 공유할 것인지에 대한 기술적인 해결이 필요하다. (e.g. session)</p>\n<p>이제 기존 설계의 문제점을 다시 생각해보자. 사진의 설계에서는 서버도 하나고 DB도 하나이다. 서버 하나에 트래픽이 몰리면 서비스가 무조건 지연되고, 그 서버가 죽으면 모든 유저가 서비스를 사용할 수 없는 대형 장애가 발생한다. DB도 마찬가지다. DB의 리소스가 부족하면 서버가 살아있고 멀쩡한 상태여도 병목이 서비스에 영향을 끼치게 되며, 혹여나 DB 서버에 문제가 생겨서 데이터가 날아간다면 미리 백업을 해두지 않는 이상 복구할 방법이 존재하지 않는다. 현재의 설계에서는 서버와 DB 모두가 <a href=\"https://ko.wikipedia.org/wiki/%EB%8B%A8%EC%9D%BC_%EC%9E%A5%EC%95%A0%EC%A0%90\">SPOF(single point of failure)</a>이다. 그래서 SPOF를 만들지 않기 위해서는 하나의 서버가 다운되기까지해도 전체 서비스에 영향을 끼치지 않는 환경을 만들어야 하기 때문에 어차피 서버의 갯수를 늘려야만 한다. 서버는 그냥 서버를 늘려서 서비스를 똑같이 띄우면 되는데 DB는 어떻게 처리할까? 물론 정말 고성능 DB를 써서 모든 데이터에 대한 관리를 하나의 DB에서 처리해도 된다. 하지만 보통 DB의 데이터는 매우 중요하기 때문에 replication하고, 이를 master-slave라 부르며 관리한다. 원본DB에서는 주로 CUD 요청을 날리고 read는 slave에 요청 하도록 분리할 수 있다. 여기까지 하면 SPOF는 없어진다. 서버도 병렬적으로 여러개이기 때문에 한 서버가 죽더라도 서비스 전체에 영향을 끼치지는 않을 것이며, DB도 모든 DB가 동시에 죽는게 아니라면 master가 죽더라도 slave들 중 하나를 master로 선정해서 다시 운영될 것이고 덕분에 DB장애도 전체 서비스에 영향을 끼치지는 않을 것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 131.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAABYlAAAWJQFJUiTwAAAC+klEQVRIx+2VT28bRRjG8xn4AHyVSnwFDpwoByToBYlDubUHQEUoCpEIIn9kCStKoAWVtihYCZQmKrgxSVonjRP/Sxo7sddrr9f7b2Z3s3HDD+0msdeENge4wWH07sy87zPPvM+j2SHDcfk3x9B/FLBjSzqmiGJvHiaE0ZbopzG+/2JAW2J5Ac7R8UByGNuWwBQejvQwhXshWAQYMtmv1iitZNEMp18kPIKjAFXvUG6YKLrdY/5yht0/uHv9Q+68+go7N5Mc2g10x0MzXBKJzxi9Nczrs1Xev1empllY4gJAOzimuLbC/StvMHL5bQqVOtIPqDZ0RkavcSM5yaUvs7w2vs5e08SW3ssB25ZL4DvsZOZ498YUqeUcQbeLLY+Zmh9mJvMpmW2Fjb3WSVFMnBeoLNEtiSl8lrNblCs1tgol1nN5Hm/mWcluIF0f6fkDSl9oG0v61NUW6cwKO3v77FZrPEwvUzloRAKFindi9hmwWOyQobOJbgnc4DlLvz4iVyiTK5Si73At3A/tcwIQFspzFjtZjwFGvjMdhH9ExxLY7mHvoJqq0dA6tE2BdQoWmt0+p7g8AYwWbUlDt0jNLzAzO8ujzCr7DY1cvkT691XW1jd58GCR1FqR9xYN3kw1WdqzkFKiWSKqH+ihKQ9R6ypffD7GxNgY927fQdE6rD7ZYKdyQPFZlWI+zw9PFd5ZMnkr1eJ2SUL3CNsLeobvMxQeTVXj7kcfk7h6lfmf7rO7X2fxYZqnWwWym9scKA0yy9tcT65yZfxHPvh6jk8mJ5n49nsMx+9f2TgdatjHhZ/JT8+we6BEB4WihIKELhDBc1pKi+3JmyS+m2EqOcrEN0lGvhrHtJ3Y8xWylD6m2sJWmhh1Fe1ZBcM9jESJbmEJdOljFct4SpNC+hembk0zPJ1g7reFfg8HnqqwD8KLwA3pn/faWY70aTtuZK/H65u0DbuX12d4Go2/M+5fcs7Ahd/t+bQTV/nCEWcXOyhsx1lLBhn+/9f7J4B/AuIeiJtlJrqeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"basic-architecture-error\"\n        title=\"basic-architecture-error\"\n        src=\"/static/6045ff6c7f834ef63ae7267979f00e8c/37523/basic_architecture_error.png\"\n        srcset=\"/static/6045ff6c7f834ef63ae7267979f00e8c/e9ff0/basic_architecture_error.png 180w,\n/static/6045ff6c7f834ef63ae7267979f00e8c/f21e7/basic_architecture_error.png 360w,\n/static/6045ff6c7f834ef63ae7267979f00e8c/37523/basic_architecture_error.png 720w,\n/static/6045ff6c7f834ef63ae7267979f00e8c/302a4/basic_architecture_error.png 1080w,\n/static/6045ff6c7f834ef63ae7267979f00e8c/9239a/basic_architecture_error.png 1246w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 140.55555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEI0lEQVRIx6WV7U9TZxjG+dP2fcuMX8yWLNkSs2zZMjWLMc7NRL+YLHMkvmDEIf3gNkQjLyIWAVtaUMBCaYsFpNjR0rdzek5PT89LW0B/2/M0xYLMYfbh7t3n7ep1Pff13G3TTRutbO1EybTRTYdSxaG5psu5RjTnRd4v2sRHpfaKSm0be/M1ulxoHDYsF6f+ateBd4FJQMHmYX8vQb+PwT9voek6esWVYDm1xNOns5K1GB8IUDEsfH23CA7fw/9HO4amSsCyXWM9lWL+3kWuXrnM8RMnSWcLlO3quyWnNIMTnaP4Zga4PtBLakPBsBxMu87yX8sEJq7y05lTHDp0mEz+AICm7XCu8y53vF6iM140rURJSLZrZDIpJsZHGB8dob+/D1XTKVnuuwGNimDjksqqxFcSpLIF5iOLrCSSLCeShGPPsevbOPXtgxalUVHTqTG3EOPJbIj1TJ5ofIVxfxBFN+TGolE5uG2aFlH0MveHh9HKDhNTUywsxiUz6c/KAX3YZCgOWbU6g0PTnD//Ox7PI1mcvab+r9hh2JBd5Zuvr3D0i3Y+OXKBjbxO2Xb/H2BgcpFj33XQPzC1S+J7AbY+tZyqMbfwnLX1tBy/D9guhiKLe7RrW0SfL8lKt97fgRm2bhbWsKqbTD+bZ9wfYD2T28WyNTTTplhu5NaraWvtIo3usk3f4AMp2d16LdfEfGuIOct2qLsOrrO7C+0wFBtTmTxLK6tMz4aIxZd5kUiSUzSyikYmr5IpFEnnFDTDJJK1uB03eJw0Jcsdhk0PirvzB4Jc67iGx+PhZlcXNzpvEI4syqfoD04xOf2MkTEfQ8Nezj0p8UFvjk8fKMTzFhXLkcBtb0y9xURgks7r1+m+2Y2n20PXb12EIzH5DFeTKV6mMiSS66y8THFhWuekX+V7n8pCtiKvYBegaABj4z7aL/4qWV672sHlS5eYDYV5NO4jFI4SjsWZi8RIJFNcmTf4clTjh6DOqmJhWnskV6qbzIbm6em5TU9PL7137jL8cIR8UZeFMp06FXdThlWtk8yq+CIJomsbGC3mf6vKIq+tb8gfSecKsoWJptE0v2pYqGWbosi6gVoypX1E7DBs9ZEAEnYR0h54H7H0Yg1fYJLY0gsJWnddNqsOm1WXrVpVZjHeqrqyMG8BNr9v5BUJNjMXloxFle97R7mzWuWXmSKeaIn2Zzrd0RId8zqXQjrLBeuN5L1/lYZVla9GyA0txIhEY0TTGp97VT7uL/BRX4HDgwUODTTyh30F+paNtwH3yhf3arp1NjI5YhmDY4+LfDumcmRI4bivyGfDCl+NqhwdUfcH3Cu9AWxjOTXSus3PMxqnA0VOT6ic8uU5G1T5MahxJlBkOm3uD/hvwEal0QwU0yVTUAnHV2VXUk1HVr78T1H+BkVb99N7xCafAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"add-lb-and-replications\"\n        title=\"add-lb-and-replications\"\n        src=\"/static/4d5d787c3ee567ca1f37f7ef93aa9901/37523/add_lb_and_replications.png\"\n        srcset=\"/static/4d5d787c3ee567ca1f37f7ef93aa9901/e9ff0/add_lb_and_replications.png 180w,\n/static/4d5d787c3ee567ca1f37f7ef93aa9901/f21e7/add_lb_and_replications.png 360w,\n/static/4d5d787c3ee567ca1f37f7ef93aa9901/37523/add_lb_and_replications.png 720w,\n/static/4d5d787c3ee567ca1f37f7ef93aa9901/302a4/add_lb_and_replications.png 1080w,\n/static/4d5d787c3ee567ca1f37f7ef93aa9901/077b7/add_lb_and_replications.png 1166w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그림만 봐도 뭔가가 늘어났다. 몇 년 안되지만 지금까지 일해온 바로는 이렇게 뭔가가 늘어날 수록 더 민감하게 관리해야 한다. (단순하면 민감하지 않아도 된다는 것은 아니다.) 최초의 설계와 비교했을 때 지금 설계를 운영하기 위해서는 일단 서비스(소프트웨어)가 서로에게 영향을 줄 필요가 없도록 잘 구현되어 있어야 한다. 대충 만들어도 된다고 해서 정말 너무 대충 만들어서 웹 서버와 정기적으로 도는 job들이 다 같은 프로세스로 뜨는 것들이 있다. 이런 서비스는 병렬적으로 돌기 어렵다. 두 인스턴스가 같은 시간에 배포된다면 job들이 같은 시간에 동시에 n번 돌 것이기 때문이다. 이런 케이스라면 일단 웹 서버와 job을 먼저 분리해 내야 한다. 그런데 이제 DB에 무슨 작업을 하는 job들이 돌고 있다면 같은 소스 내에 정의된 DAO들에 의존하고 있을 것이다. ORM으로 DB를 물려서 DB의 데이터를 entity class로 가져오고 어떤 연산을 해서 그 entity들의 값을 바꾼 뒤 다시 update 치는 소스코드들은 언제나 본다. 그렇다면 job을 분리해 내기 위해서는 새 프로젝트에 ORM 세팅과 Entity 정의들을 똑같이 새로 만들어야 한다. 이런식으로 서비스가 분리될 때 마다 매번 entity들을 똑같이 적고 있을 수 없으니 이제 데이터에 접근할 용도의 서비스를 분리하기 시작할 것이다. 이런식으로 나가면 할 일이 정말 많아지는데, 이렇게 <a href=\"https://www.redhat.com/ko/topics/microservices\">어플리케이션을 상호 독립적인 최소 구성 요소로 분할하는</a> 설계를 보고 우리는 <strong>마이크로서비스</strong> 라고 부른다.</p>\n<p>물론 자세히 따지면 load balancing이라는게 무엇인지 이해할 필요도 존재한다. 하지만 어지간한 규모에서는 load balancing에 대해서는 자세히 생각할 필요가 없다. 클라우드 환경이라면 AWS ELB, 아니면 보통 nginx 같은 L7 switch들을 사용하는데, 이런 load balancer들은 application layer에서 load balancing을 수행하기 때문에 패킷을 가지고 트래픽을 분산할 수 있다. 가장 대표적인 예시로, 서비스를 운영하다 보면 그냥 무작위로 도메인이나 아이피를 돌면서 포트가 열려있는지 확인하고 열려있으면 때려보는 중국인 친구들을 방어해야 할 일이 종종 있는데 nginx 하나 붙여놓으면 든든하다. 그래서 load balancer에 대해서는 나도 아직 잘은 모르고, 이 글에서는 나올 일 없을 것이다.</p>\n<p>이번 글에서는 보통 학부생들이 수업 들으면서 띄워보는 웹 서버의 구조를 한 번 그려봤고 그것을 단순하게는 어떻게 개선할 수 있을지 살펴보았다. 다음 글에서는 아마 네트워크나 캐시, CDN 등의 얘기를 할 것 같다.</p>","frontmatter":{"date":"October 11, 2021","title":"주니어의 눈에 비치는 설계 1","categories":"Tech","author":"fleta","emoji":"🔮"},"fields":{"slug":"/chat/tech/architecture-components/"}},"prev":{"id":"ddee669a-30c3-511c-a934-59dc2cc6f14d","html":"<p>오전 6시 도착 - 반포한강공원주차장, 세빛주차장 둘 차이</p>\n<p>6시~6시 반: 차에서 에어컨틀고 뻐기기</p>\n<p>6시 반: 쎄해서 나가보니 이미 돗자리 펴고 앉아있음 (대충 2n명) 소름돋아서 바로 아침먹고 착석. 7시쯤 착석했는데 내 앞에 이미 40명 내외</p>\n<p>9시: 한강의 수위가 올라가서 휴식 천막까지 물이 들어옴 긴급대피. 이 때 이미 3번째 줄이 있었으나 다들 간격을 꽤 뒀던걸 생각하면 150 전후였을 것 같음</p>\n<p>대피 이후~10시 40분?: 주최는 급하게 천막을 옮기고 그 동안 사람들은 땡볕에서 대기. 이 날 폭염경보? 특보?\r\n주최는 얼음물 돌림. 나는 양산 들고 갔는데 양산도 익어서 너무 더웠음. 이 날 세시간 자고 와서 반쯤 기절잠\r\n이 한시간 반 동안 사람이 대충 1xxx명 정도까지 늘어났음.</p>\n<p>10시 4n분 ~ 11시 n분: 천막 위치 옮겨져서 순서대로 천막 아래로 이동 시작.</p>\n<p>11시 2n분: 원레 15시 시작 예정인 테이블링을 당김. 사람이 너무 많았어서 천막이 커버를 못하니 어쩔 수 없는 결정이었을 듯</p>\n<p>11시 37분: 테이블링으로 예약 성공. 내가 앞에서 거의 40번째 후반이었음(처음에 40 내외라고 적었는데 중간에 누군가들의 일행들이 몇 명 더 끼였음 )\r\n순번 29번.</p>\n<p>예약 이후에 그냥 차 끌고 집 돌아가서 샤워하고 점심먹고 놀다가 나옴. 주차장에 대충 3시쯤 다시 도착\r\n다시 도착하고 보니 수라도 그 자체. 몇 시간 동안 테이블링 계속 하고 있었을텐데 웨이팅은 천막을 다 채울 정도\r\n나는 적당히 건물 안에 들어가서 바닥에서 대기함.</p>\n<p>4시 12분: 테이블링 알람 왔음. 순번 치고 꽤 빨리 빠졌다고 생각함</p>\n<p>들어가니 그냥 무슨 컨베이어벨트 마냥 걸으면서 물건 담음. 나는 어차피 “젠부 쿠다사이” 여서 보이는거 다 담음. 아크릴 스탠드 액자?는 장식판인데 이건 진짜 용도가 안 보여서 걸렀다\r\n대충 17만 얼마 나옴. 젠부 쿠다사이 치고는 저렴했다.\r\n리셀 막는다고 그러는지 장패드를 제외하고는 한 명이 제품을 한 개씩 밖에 구매를 못 했음. 개인적으로도 이게 맞다고 생각은 하는데 조금 말이 안된다고 생각하는게 있었음.\r\n손풍기나 마스킹테이프, 포토카드, 키링은 종류가 여러개였는데도 한 개 밖에 구매를 못함. 이런건 좀 아쉬웠다고 생각함.\r\n주 고객층이 학생이니까 패키지를 분리해서 가격을 낮추는 것도 이해는 하는데, 이렇게 제한할거면 아예 패키징을 하는게 맞지 않을까 하는 생각도 함. (한 팩에 키링이 종류별로 들어 있도록?)</p>\n<p>구매하고 나와서 짐을 차에 놓고 가벼운 마음으로 다시 돌아가려니 섬 입장이 안 됨. 그래서 급하게 조사를 하니 엄청난 일이 있었음.</p>\n<ul>\n<li>사람들이 들어가는 과정에서 줄이 길어졌음. 다리 위를 사람으로 다 채웠을 정도. 그래서인지 다리가 휘었음</li>\n<li>세빛섬도 수용 제한 인원을 초과했다는 공지(링크)가 있었음. 이름 그대로 둥둥 떠 있는 인공 섬이라 그런지 한도 무게가 있는 듯.</li>\n<li>다리가 휘는 등 위험해 보이는 상황이 발생하니 결국 주최는 사람들을 섬 밖으로 나가게 하고 섬으로 들어가는 줄을 통제함 &#x3C;- 아수라장의 시작</li>\n</ul>\n<p>그래서 섬 입장줄이 엄청 길어졌고 저녁까지 사람이 계속 늘어서 대부분 땡볕에서 웨이팅을 함. 완전 수라장 그 자체.\r\n중간에 앰뷸런스 탄 사람이 발생했을 정도. 내 눈으로 본 건 두명인데 한 명은 제 발로 앰뷸런스 탔고 한 명은 실려갔다. 좀 더 있는 듯.\r\n나는 미니게임 하려고 했는데 깔끔하게 포기. 차에 들어가서 시동 걸고 에어컨 바람 쐬면서 몇 시간 있다가 해 떨어진 이후로 시동 끄고 좀 잤음</p>\n<p>자고 일어나니 대충 8시였고 그 때도 여전히 통제가 있었고 줄이 엄청 길었다. (섬 라인 그림) 입구 출구가 분리되었는데 입구에서 출구까지 줄이 이어졌을 정도\r\n여기서 또 2차로 포기하고 근처에서 라면 먹음\r\n라면 먹고 쉬고 돌아오니 대충 8시 50분: 갑자기 줄이 없어지고 다들 자유롭게 입장하고 있었음. 이 때다 싶어서 들어감. 그게 9시 n분.\r\n원래라면 9시 마감인데 내가 어떻게 카드 교환만 안 되냐고 애원(?)하니 카드를 주셨다. 아직 안 치워진 가챠도 덕분에 돌려볼 수 있었음. 내 다음에 온 사람부터는 카드도 못 받았음.\r\n푸드트럭도 얼른 가서 메뉴 호다닥 고르고 주문함. 내 다음 사람인가 다다음까지인가 주문 받고 얘도 마감됨.\r\n음식 수령하고 나가니 2차 창작 부스들도 정리 중이었음. 지나가다 귀여운 스티커가 있어서 딱히 필요는 없지만 세 장 샀다.\r\n세 장 사면서 귀엽다고 말씀드리니 좋아하시는 것 같았다. 이게 동인의 매력이지.</p>\n<p>끝. (자세한 내용 정리 + 그림)</p>","frontmatter":{"date":"July 30, 2022","title":"원신 2022년 여름 이벤트 후기","categories":"Chat Subculture","author":"fleta","emoji":"✨"},"fields":{"slug":"/chat/subculture/genshin-impact-event-2022-summer/"}},"site":{"siteMetadata":{"siteUrl":"https://fleta.github.io","comments":{"utterances":{"repo":""}}}}},"pageContext":{"slug":"/chat/retrospective-2021/","nextSlug":"/chat/tech/architecture-components/","prevSlug":"/chat/subculture/genshin-impact-event-2022-summer/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}