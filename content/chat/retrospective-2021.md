---
emoji: 🔮
title: 2021년 회고 
date: '2021-12-31'
tags: retrospective
author: fleta
categories: Chat
---

# 알고리즘 스터디 계획

## 1. 2021년에 뭐했나 

### 1월

입사 3개월차. 평소에 좀 많이 이상한 분이라고 생각했던 옆 자리 사람이 정직을 당했다. 
정말 이상한 코드들이 널리고 널렸는데 개선을 못 하게 하는 주범이 사라지게 되어서 앞으로 어떻게 할 지 얘기를 좀 했었던 것 같다.
일단은 남아있는 생쿼리들을 ORM으로 옮기자고 얘기해서 feature들을 올리면서 중간중간 리팩토링을 개선했던 것 같은데 그 뒤로 기억이 잘 안 난다.
2월달에 엄청난 사건이 터졌던게 원인인 것 같다.

### 2월

하룻밤만에 시스템이 싹 다 사라지는 엄청난 장애가 터졌다. 자고 일어나보니 몇몇 분들은 한밤중에 연락 받아서 진작에 회사 나가서 인프라를 다시 구축하는 중이었다. 하루 정도를 들여 웹 스토어는 다시 오픈했으나 기존 주문건을 수기로 처리하느라 신규 주문의 처리가 지연되었으며, 이 때문에 평소 대비 5배 정도까지 주문이 쌓이게 되었다. 문제는 기존 시스템이 n+1문제가 심각해서 주문건이 5배 수준이 되었다고 페이지들이 로딩이 안 되어서 시스템으로 주문을 처리할 수 없는 지경까지 이르렀던 것이다. 그래서 단기간에 사용 가능하도록 바꾸고자 3주동안 매일 12시간씩 일했던 것 같다. (10시에 출근해서 10시에 퇴근하는 ..)
제일 심했던 케이스는 아직도 기억하는데, 하나의 endpoint를 서로 다른 6개 정도의 서브도메인에 해당하는 14개의 메뉴에서 사용하고 있는 케이스였다. 그 함수를 살펴보니 혼돈 그 자체였다. 서로 다른 서브도메인을 위한 비즈니스 로직이 같은 컨트롤러에 엮여 있었고 하나의 메소드에서 모든 경우의 수를 다 생각해야 했기에 join이 10개씩 걸린 쿼리가 실행되는 코드들이 무수한 if들과 함께 널려있었다. 거의 java 코드의 역사책을 보는 수준이었는데, 어떤 함수는 jdbcTemplate로 실행되는 쿼리 결과를 바탕으로 돌아가고 어떤 함수는 (custom)criteria builder로 쿼리가 돌아가고 어떤 함수는 JPA로 돌아가고 있었다. JPQL도 native query인 것과 아닌 것들이 섞여 있을 정도로 난리도 아니였다. 사실 방금 나온 얘기들만 해도 repository를 통해 외부의 데이터를 가져오는 코드가 최소 5줄은 된다는 소리일텐데, 하나의 함수에서 데이터를 5번씩이나 가져와야 할 일이 얼마나 있을까? 
방금 얘기했던 케이스는 정말 심했던 편이지만 여튼 전체적으로 문제가 많아서 빠르게 고칠 수 있는 부분은 빠르게 고쳐서 서비스를 운영 가능한 수준까지 올리는데 거의 1주 정도를 밤낮없이 일했던 것 같다. 그래서 날아간 서비스를 복구하고 기존 서비스를 개선하느라 순식간에 지나간 한 달이었던 것으로 기억한다.

### 3월

솔직히 잘 기억 안나서 커밋로그들을 봤는데 기존 서비스의 편의성과 관련된 기능 업데이트에 집중했던 것 같다. 기록 상으로는 셀러들 시스템이랑 연동한다던가, 운영 정책 변경에 대응하기 위한 수정을 하는 등의 업무에 집중했던 것 같다. 커밋 로그들이 주로 생산성 개선, 정책 변경 대응같이 남아있는 것 봐서는 그랬던 것 같은데 잘 기억은 안 난다.

### 4월



### 5월
### 6월
### 7월
### 8월
### 9월
### 10월
### 11월
### 12월
